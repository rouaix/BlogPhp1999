<?php  $ok = true;  $sql = "select email,login from user where email='".@$_SESSION["form_email"]."'";  @$result = mysql_query($sql);  if($ligne = mysql_fetch_array($result)){    if($ligne["login"] != @$_SESSION["form_login"]){      $ok = false;      $_SESSION["alerte"] .= "<p>Cet identifiant est d&iacute;j&agrave; utilis&iacute; !";    }    if($ligne["email"] != @$_SESSION["form_email"]){      $ok = false;      $_SESSION["alerte"] .= "<p>Cet email est d&iacute;j&agrave; utilis&iacute;e !";    }          }else{    if(!email_validation(@$_SESSION["form_email"])){      $_SESSION["alerte"] .= "<p>Adresse email invalide.";      $ok = false;     }        if(strlen(@$_SESSION["form_login"])<3){      $_SESSION["alerte"] .= "<p>Votre identifant est trop court.";      $ok = false;     }           if(strlen(@$_SESSION["form_prenom"])<1){      $_SESSION["alerte"] .= "<p>Veuillez saisir votre pr&eacute;nom.";      $ok = false;     }    if(strlen(@$_SESSION["form_nom"])<1){      $_SESSION["alerte"] .= "<p>Veuillez saisir votre nom.";      $ok = false;     }    if($_SESSION["form_motdepasse"] != $_SESSION["form_confirmationmotdepasse"]){        $_SESSION["alerte"] .= "<p>Mauvaise confirmation de mot de passe.";        $ok = false;        unset($_SESSION["form_motdepasse"]);        unset($_SESSION["form_confirmationmotdepasse"]);         }else{      if(strlen(@$_SESSION["form_motdepasse"])<5){        $_SESSION["alerte"] .= "<p>Votre mot de passe est trop court.";        $ok = false;       }        }      if(strlen(@$_SESSION["form_motdepasse"])<5){      $_SESSION["alerte"] .= "<p>Votre mot de passe est trop court.";      $ok = false;     }          }   if($ok==false){    $_SESSION["page"] = "user.inscription";    @header("location:".$_SESSION["location"]);  }else{    //-------------- Enregistrer !        if (isset($_SESSION["form_login"])) {      if(isset($_SESSION["form_email"])){        $sql = "select login,email from user where email='".@$_SESSION["form_email"]."'";        @$result = mysql_query($sql);        if($ligne = mysql_fetch_array($result)){          $_SESSION["loguser"] = $_SESSION["form_login"];          $_SESSION["logpass"] = $_SESSION["form_motdepasse"];          //login();                            }else{             $_SESSION["x"]["type"] = "user";          $_SESSION["x"]["login"] = $_SESSION["form_login"];          $_SESSION["x"]["email"] = $_SESSION["form_email"];          $_SESSION["x"]["motdepasse"] = sha1($_SESSION["form_motdepasse"]);              $_SESSION["x"]["prenom"] = ucfirst($_SESSION["form_prenom"]);          $_SESSION["x"]["nom"] = strtoupper($_SESSION["form_nom"]);          $_SESSION["x"]["civilite"] = $_SESSION["form_civilite"];          $_SESSION["x"]["horloge"] = date_heure();          $champs = "`id`";          $valeurs = "''";                    $result = mysql_query("SHOW COLUMNS FROM user");          if (mysql_num_rows($result) > 0) {            while ($row = mysql_fetch_array($result)) {              if ($row[0] != "id"){                if(isset($_SESSION["x"][$row[0]])){                  $champs .= ",`".$row[0]."`";                  $valeurs .= ",'".$_SESSION["x"][$row[0]]."'";                }else{                  $champs .= ",`".$row[0]."`";                  $valeurs .= ",''";                }              }            }          }else{            $_SESSION["alerte"] .= "<p>Pas de table !</p>";          }          $sql = "INSERT INTO `user` (".$champs.") VALUES (".$valeurs.");";          if(!$result = mysql_query($sql)) {            $_SESSION["alerte"] .= "<p>Erreur 002";          }else{            $_SESSION["alerte"] .= "<p><b>Inscription r&eacute;ussie.</b><br /></p><br /><p>Un email de confirmation vous a &eacute;t&eacute; envoy&eacute;. Veuillez v&eacute;rifier votre bo&icirc;te &agrave; lettres <i>(Regardez aussi dans vos courriers ind&eacute;sirables.)</i><p><br /></p>";                          $_SESSION["email"]["email"] = $_SESSION["x"]["email"];            $_SESSION["email"]["titre"] = "NÃ©ocratie.net (Inscription de : ";            $_SESSION["email"]["titre"] .= $_SESSION["x"]["prenom"];            $_SESSION["email"]["titre"] .= " ";            $_SESSION["email"]["titre"] .= $_SESSION["x"]["nom"];            $_SESSION["email"]["titre"] .= ")";                                    $_SESSION["email"]["message"] = "Merci pour votre inscription."."\r\n";            $_SESSION["email"]["message"] .= "\n"."\n";            $_SESSION["email"]["message"] .= "Veuillez conserver ce message."."\r\n";            $_SESSION["email"]["message"] .= "\n"."\n";                           $_SESSION["email"]["message"] .= "Votre identifiant de connexion : ".$_SESSION["x"]["login"]."\r\n";            $_SESSION["email"]["message"] .= "\n"."\n";            $_SESSION["email"]["message"] .= "Votre mot de passe : ".$_SESSION["form_motdepasse"]."\r\n";                        email_envoyer();                        $_SESSION["page"] = "accueil";            $_SESSION["loguser"] = $_SESSION["x"]["login"];            $_SESSION["logpass"] = $_SESSION["form_motdepasse"];                      }          unset($_SESSION["x"]);        }          }    }          unset($_SESSION["form_login"]);    unset($_SESSION["form_motdepasse"]);    unset($_SESSION["form_prenom"]);    unset($_SESSION["form_nom"]);    unset($_SESSION["form_civilite"]);    unset($_SESSION["form_confirmationmotdepasse"]);   }?>