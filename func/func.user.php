<?phpfunction login_form(){  ?>  <form id="FormLog" class="login" enctype="multipart/form-data" method="post" action="<?php echo $_SESSION["index"]; ?>">  <label><input placeholder="Identifiant" tabindex="1" type="text" name="loguser" value="" title="Identifiant"></label>  <label><input placeholder="Mot de passe" tabindex="2" type="password" name="logpass" value="" title="Mot de passe"></label>  <label><a href="<?php echo $_SESSION["index"];?>?page=user.secour" title="Identifiant ou mot de passe perdu ?"><img id="bt_info" src="images/boutons/64/R005.png"></a><input id="bt_valider" src="images/boutons/64/B009.png" type="image" title="Valider" /></label>  </form>  <?php}function login(){  if(isset($_SESSION["loguser"]) && isset($_SESSION["logpass"])){    if($_SESSION["loguser"]!="" && $_SESSION["logpass"]!=""){      $sql = "select * from user where login='".strtolower($_SESSION["loguser"])."'";      if($result = mysql_query($sql)){        $ligne = mysql_fetch_array($result);        $pass=$ligne["motdepasse"];        $test = strtolower($ligne["login"]);        if($test == strtolower($_SESSION["loguser"]) && $pass == sha1($_SESSION["logpass"])){          if($ligne["prenom"]!=""){            $_SESSION["usernom"]=ucfirst($ligne["prenom"])." ".strtoupper($ligne["nom"]);          }else{            $_SESSION["usernom"]=strtoupper($ligne["nom"]);          }          if($ligne["civilite"]!=""){            $_SESSION["usernom"] = cherche_civilite($ligne["civilite"])." ".$_SESSION["usernom"];          }          $_SESSION["username"]=$ligne["nom"];          $_SESSION["userid"]=$ligne["id"];          //$r = mysql_query("INSERT INTO `hit` (`id`,`user`,`nom`,`horloge`,`session`) VALUES ('','".$_SESSION["userid"]."','Login','".mktime(date("H"), date("i"), date("s"), date("m"), date("d"), date("Y"))."','".session_id()."');");        }else{          unset($_SESSION["username"]);          $_SESSION["userid"]="Visiteur";          unset($test);          unset($pass);        }      }    }    unset($_SESSION["logpass"]);    unset($_SESSION["loguser"]);  }   login_connection();}function login_connection(){  $_SESSION["visiteur"]["inconnu"] = 0;  $_SESSION["visiteur"]["connu"] = 0;  $_SESSION["visiteur"]["membre"] = 0;  $deconnection = 600 ; // En secondes  if($result = mysql_query("select * from hit where session ='".session_id()."'")){    if($ligne = @mysql_fetch_array($result)){      $liste = "user='".$_SESSION["userid"]."',horloge='".mktime(date("H"), date("i"), date("s"), date("m"), date("d"), date("Y"))."',session='".session_id()."'";      $sql = "update hit set ".$liste." where session ='".session_id()."'";      $result = mysql_query($sql);    }else{      $sql = "INSERT INTO `hit` (`id`,`user`,`nom`,`horloge`,`session`) VALUES ('','".$_SESSION["userid"]."','','".mktime(date("H"), date("i"), date("s"), date("m"), date("d"), date("Y"))."','".session_id()."');";      $result = mysql_query($sql);    }  }  if($result = mysql_query("select * from hit")){    while ($ligne = @mysql_fetch_array($result)){      $y = mktime(date("H"), date("i"), date("s"), date("m"), date("d"), date("Y"));      $x = $ligne["horloge"];      $ecart = $y - $x;      if($ecart > $deconnection){        $r = mysql_query("delete from hit where id='".$ligne["id"]."'");      }else{        if($ligne["user"] == "Visiteur"){          $_SESSION["visiteur"]["inconnu"] ++ ;        }else{          $_SESSION["visiteur"]["connu"] ++ ;        }      }    }  }  $_SESSION["visiteur"]["inconnu"] = str_pad($_SESSION["visiteur"]["inconnu"], 3, "0", STR_PAD_LEFT);  $_SESSION["visiteur"]["connu"] = str_pad($_SESSION["visiteur"]["connu"], 3, "0", STR_PAD_LEFT);  @$result = mysql_query("select * from user");  $_SESSION["visiteur"]["membre"] = str_pad(mysql_num_rows($result), 3, "0", STR_PAD_LEFT);}function logged(){  //user_photo();  $ok = 0;  if(isset($_SESSION["usernom"])){    if($_SESSION["usernom"]!=""){$ok = $ok + 1;}  }  if(isset($_SESSION["username"])){    if($_SESSION["username"]!=""){$ok = $ok + 1;}  }  if(isset($_SESSION["userid"])){    if($_SESSION["userid"]!=""){$ok = $ok + 1;}  }  if($ok > 1){      $p = photo("user",$_SESSION["userid"]);      echo "<label class=\"logged\">";         if($p != ""){         echo "<a href=\"".$_SESSION["index"]."?page=user\" title=\"Mon Compte\">";         echo "<img src =\"".$p."\" id=\"bt_user_logout\">";         echo "</a>";      }else{         echo "<a href=\"".$_SESSION["index"]."?action=logout\" title=\"D&eacute;connexion\">";      echo "<img id=\"bt_logout\" src=\"images/png/64/exit.png\">";      echo "</a>";      }      echo "</label>\n";      echo "<label class=\"logged\">";         echo "<b>".@$_SESSION["usernom"]."</b>";         if($p == ""){            echo "<br /><a href=\"".$_SESSION["index"]."?page=user\" title=\"Mon Compte\">Mon compte</a>";         }else{            echo "<br /><a href=\"".$_SESSION["index"]."?action=logout\" title=\"D&eacute;connexion\">D&eacute;connexion</a>";         }      echo "</label>\n";  }}function motdepasse_generation(){  $chaine = "abcdefghijklmnopqrstuvwxyz.ABCDEFGHIJKLMNOPQRSTUVWXYZ-0123456789+@";  $nb_caract = 8;  $pass = "";  for($u = 1; $u <= $nb_caract; $u++) {    $nb = strlen($chaine);    $nb = mt_rand(0,($nb-1));    $pass.=$chaine[$nb];  }  return $pass;}function est_administrateur($y){    $x = false;  if(isset($_SESSION["userid"]) && $y == $_SESSION["userid"] && $_SESSION["userid"]!= "Visiteur"){    if(isset($_SESSION["userid"]) && @$_SESSION["userid"] != "" && @$_SESSION["userid"]!= "Visiteur"){      if(isset($_SESSION["localip"]) && $_SESSION["localip"] == "192.648.69.99"){        $x = true;      }else{        //sql_connexion();        $query = "select id,type,systeme from user where id='".$y."'";        if(@$res=mysql_query($query)){          $verif=@mysql_fetch_array($res);          if($verif["type"]=="user"){            if(@$verif["systeme"]=="A" && mysql_num_rows($res)>0){              $x = true;              $_SESSION["localip"] = "192.648.69.99";            }          }        }      }    }  }else{    //sql_connexion();    $query = "select id,type,systeme from user where id='".$y."'";    $res=mysql_query($query);    $verif=@mysql_fetch_array($res);    if($verif["type"]=="user"){      if(@$verif["systeme"]=="A" && mysql_num_rows($res)>0){        $x = true;      }    }  }  return $x;}function est_utilisateur($y){  $x = false;  if(isset($_SESSION["userid"]) && $y == $_SESSION["userid"] && $_SESSION["userid"]!="Visiteur"){    if(isset($_SESSION["userid"]) && $_SESSION["userid"] !=""){      if(isset($_SESSION["localip"]) && $_SESSION["localip"] == "192.648.1.8"){        $x = true;      }else{        //sql_connexion();        $query = "select id,type,systeme from user where id='".$y."'";        if($res=mysql_query($query)){          $verif=@mysql_fetch_array($res);          if($verif["type"]=="user" && mysql_num_rows($res)!=0){            $x = true;            $_SESSION["localip"] = "192.648.1.8";          }else{            $x = false;          }        }      }    }  }else{    //sql_connexion();    $query = "select id,type,systeme from user where id='".$y."'";    if($res = mysql_query($query)){      $verif=@mysql_fetch_array($res);      if($verif["type"]=="user" && mysql_num_rows($res)!=0){$x = true;}    }  }  return $x;}function hit_sauve(){  if(isset($_SESSION["userid"])){    if($_SESSION["userid"] != ""){      $r = @mysql_query("INSERT INTO `hit` (`id`,`user`,`nom`,`horloge`,`session`) VALUES ('','".$_SESSION["userid"]."','".$_SERVER['PHP_SELF']."/page=".@$_SESSION["page"]."','".mktime(date("H"), date("i"), date("s"), date("m"), date("d"), date("Y"))."','');");    }  }else{    $r = @mysql_query("INSERT INTO `hit` (`id`,`user`,`nom`,`horloge`,`session`) VALUES ('','Visiteur','".$_SERVER['PHP_SELF']."/page=".@$_SESSION["page"]."','".mktime(date("H"), date("i"), date("s"), date("m"), date("d"), date("Y"))."','');");  }}?>