<?phpfunction affiche_notation($nom,$type,$tid,$mode){  for ($x=0;$x < 9;$x++){    $valeur[$x]  = 0;    $nbval[$x] = 0;    }  $somme = 0;   $nb = 0;  $query = "select * from notation where nom ='".$nom."' and cible_type='".$type."' and cible_id='".$tid."' and etat !='s' ";  if($z = mysql_query($query)){    $nb = mysql_num_rows($z);      $res = mysql_query($query);    while($ligne = mysql_fetch_array($res)){      if(isset($valeur[$ligne["data"]])){        $valeur[$ligne["data"]] += $ligne["data"];        $nbval[$ligne["data"]] += 1;        $somme += $ligne["data"];      }else{        $valeur[$ligne["data"]] = $ligne["data"];        $nbval[$ligne["data"]] = 1;        $somme += $ligne["data"];      }    }  }  switch ($nom) {    default :    break;    case "vote":      return affiche_notation_vote($nom,$type,$tid,$mode,$nb,$somme,$valeur,$nbval);    break;    case "etoile":         return affiche_notation_etoile($nom,$type,$tid,$mode,$nb,$somme,$valeur,$nbval);    break;                                     }}function affiche_notation_vote($nom,$type,$tid,$mode,$nb,$somme,$valeur,$nbval){  if($nb != 0 && $somme != 0){      $z = round($somme / $nb);    $p3 = @round(($nbval[3] / $nb)*100);    $p1 = @round(($nbval[1] / $nb)*100);    $p2 = @round(($nbval[2] / $nb)*100);  }else{      $p3 = 0;      $p1 = 0;      $p2 = 0;    $z = $somme;   }    if(@$_SESSION["js"]=="1"){    $so = "javascript:Ajax_Load('".$nom.$type.$tid."','".$_SESSION["index"]."?action=notation_v&nom=".$nom."&type=".$type."&tid=".$tid."&data=3')";    $pour = "javascript:Ajax_Load('".$nom.$type.$tid."','".$_SESSION["index"]."?action=notation_v&nom=".$nom."&type=".$type."&tid=".$tid."&data=1')";    $contre = "javascript:Ajax_Load('".$nom.$type.$tid."','".$_SESSION["index"]."?action=notation_v&nom=".$nom."&type=".$type."&tid=".$tid."&data=2')";  }else{    $so = $_SESSION["index"]."?action=notation_v&nom=".$nom."&type=".$type."&tid=".$tid."&data=3";    $pour = $_SESSION["index"]."?action=notation_v&nom=".$nom."&type=".$type."&tid=".$tid."&data=1";    $contre = $_SESSION["index"]."?action=notation_v&nom=".$nom."&type=".$type."&tid=".$tid."&data=2";  }    $temp = "";  $col1 = "#314d74";  $col2 = "#333";   $ico = "<img src=\"images/png/16/etoile.png\" style=\"border:0;margin:0;\">";  if($mode != "retour"){    $temp .= "<label id=\"".$nom.$type.$tid."\" style=\"height:50px;overflow:hidden;padding:0;margin:0;vertical-align:middle;\">";  }  //$temp .= str_pad($nb, 4, "0", STR_PAD_LEFT);  $temp .= "<label id=\"ibleu\" style=\"font-size:11px;font-weight:bold;width:50px;height:50px;vertical-align:middle;text-align:center;\">";  $temp .= "<p style=\"margin-top:10px;\">".$nb."<br />Vote".pluriel($nb)."</p>";  $temp .= "</label>";     if(!user_notation($nom,$type,$tid)){      $temp .= "<label style=\"background-color:".$col1.";width:16px;height:50px;margin:0;padding:0;\">";     $temp .= "<a href=\"".$pour."\" title=\"Voter\">".$ico."</a>";     $temp .= "<a href=\"".$contre."\" title=\"Voter\">".$ico."</a>";     $temp .= "<a href=\"".$so."\" title=\"Voter\">".$ico."</a>";     $temp .= "</label>";   }  //$p0 = str_pad(@$p0, 3, "0", STR_PAD_LEFT);  //$p1 = str_pad(@$p1, 3, "0", STR_PAD_LEFT);  //$p2 = str_pad(@$p2, 3, "0", STR_PAD_LEFT);  $t1 = "<div id=\"gauche\" style=\"color:#fff;background-color:transparent;position:absolute;width:95px;height:12px;overflow:hidden;top:1px;left:5px;\">".$p1."% Pour</div>";  $t2 = "<div id=\"gauche\" style=\"color:#fff;background-color:transparent;position:absolute;width:95px;height:12px;overflow:hidden;top:1px;left:5px;\">".$p2."% Contre</div>";  $t3 = "<div id=\"gauche\" style=\"color:#fff;background-color:transparent;position:absolute;width:95px;height:12px;overflow:hidden;top:1px;left:5px;\">".$p3."% Sans opinion</div>";  $temp .= "<label style=\"background-color:".$col2.";font-size:10px;font-weight:normal;width:100px;height:50px;overflow:hidden;\">\n";  $temp .= "<div style=\"position:relative;width:100px;height:16px;overflow:hidden;\"><div style=\"background-color:".$col1.";width:".$p1."px;height:16px;\">&nbsp;</div>".$t1."</div>";  $temp .= "<div style=\"margin:1px 0 1px 0;position:relative;width:100px;height:16px;overflow:hidden;\"><div style=\"background-color:".$col1.";width:".$p2."px;height:16px;\">&nbsp;</div>".$t2."</div>";  $temp .= "<div style=\"position:relative;width:100px;height:16px;overflow:hidden;\"><div style=\"background-color:".$col1.";width:".$p3."px;height:16px;\">&nbsp;</div>".$t3."</div>";  $temp .= "</label>";  if($mode != "retour"){$temp .= "</label>";}  return $temp;}function user_notation($nom,$type,$tid){  $z = false;  if(est_utilisateur(@$_SESSION["userid"])){    $query = "select * from notation where nom ='".$nom."' and cible_type='".$type."' and cible_id='".$tid."' and qui='".$_SESSION["userid"]."'";    if($res = mysql_query($query)){if($l = mysql_fetch_array($res)){$z = true;}}  }else{    $query = "select * from notation where nom ='".$nom."' and cible_type='".$type."' and cible_id='".$tid."' and ip='".$_SESSION["userip"]."'";    if($res = mysql_query($query)){if($l = mysql_fetch_array($res)){$z = true;}}  }  return $z;   //return false;}function nb_notation($nom,$type,$tid){  $query = "select * from notation where nom ='".$nom."' and cible_type='".$type."' and cible_id='".$tid."'";   if($res = mysql_query($query)){      $z = mysql_num_rows($res);   }else{      $z = 0;   }  return $z;}function affiche_notation_etoile($nom,$type,$tid,$mode,$nb,$somme,$valeur,$nbval){  if($nb != 0 && $somme != 0){      $z = round($somme / $nb);  }else{    $z = $somme;   }  if(@$_SESSION["js"]=="1"){    $e1 = "javascript:Ajax_Load('".$nom.$type.$tid."','".$_SESSION["index"]."?action=notation_v&nom=".$nom."&type=".$type."&tid=".$tid."&data=1')";    $e2 = "javascript:Ajax_Load('".$nom.$type.$tid."','".$_SESSION["index"]."?action=notation_v&nom=".$nom."&type=".$type."&tid=".$tid."&data=2')";    $e3 = "javascript:Ajax_Load('".$nom.$type.$tid."','".$_SESSION["index"]."?action=notation_v&nom=".$nom."&type=".$type."&tid=".$tid."&data=3')";      $e4 = "javascript:Ajax_Load('".$nom.$type.$tid."','".$_SESSION["index"]."?action=notation_v&nom=".$nom."&type=".$type."&tid=".$tid."&data=4')";      $e5 = "javascript:Ajax_Load('".$nom.$type.$tid."','".$_SESSION["index"]."?action=notation_v&nom=".$nom."&type=".$type."&tid=".$tid."&data=5')";  }else{    $e1 = $_SESSION["index"]."?action=notation_v&nom=".$nom."&type=".$type."&tid=".$tid."&data=1";    $e2 = $_SESSION["index"]."?action=notation_v&nom=".$nom."&type=".$type."&tid=".$tid."&data=2";    $e3 = $_SESSION["index"]."?action=notation_v&nom=".$nom."&type=".$type."&tid=".$tid."&data=3";      $e4 = $_SESSION["index"]."?action=notation_v&nom=".$nom."&type=".$type."&tid=".$tid."&data=4";      $e5 = $_SESSION["index"]."?action=notation_v&nom=".$nom."&type=".$type."&tid=".$tid."&data=5";  }  $temp = "";  $col1 = "#314d74";  $col2 = "#333";   $ico = "<img src=\"images/png/16/etoile_053.png\" style=\"border:0;margin:0;\">";   $ico1 = "<img src=\"images/png/16/et_1.png\" style=\"border:0;margin:0;\">";   $ico2 = "<img src=\"images/png/16/et_2.png\" style=\"border:0;margin:0;\">";   $ico3 = "<img src=\"images/png/16/et_3.png\" style=\"border:0;margin:0;\">";   $ico4 = "<img src=\"images/png/16/et_4.png\" style=\"border:0;margin:0;\">";   $ico5 = "<img src=\"images/png/16/et_5.png\" style=\"border:0;margin:0;\">";  if($mode != "retour"){    $temp .= "<label id=\"".$nom.$type.$tid."\" style=\"padding:0;margin:0 5px 0 0;\">";  }  //$temp .= str_pad($nb, 4, "0", STR_PAD_LEFT);  $temp .= "<label style=\"margin:0 5px 0 0;width:80px;height:16px;\" title=\"".$nb." Notation".pluriel($nb)."\">";   if( $z == 0){$ico0 = $ico;}   if( $z > 0){$ico0 = $ico1;}   if( $z > 1){$ico0 = $ico2;}   if( $z > 2){$ico0 = $ico3;}   if( $z > 3){$ico0 = $ico4;}   if( $z > 4){$ico0 = $ico5;}   for ($x=0;$x < 5;$x++){      if($x < $z){         $temp .= $ico0;      }   }   $temp .= "</label>";   if(!user_notation($nom,$type,$tid)){      $temp .= "<br /><label style=\"margin:0 0 0 5px;padding:0;width:105px;height:16px;\">";      $temp .= "<img src=\"images/png/16/fg_0007.png\" title=\"Noter\" style=\"border:0;margin:0 5px 0 0;\">";      $temp .= "<a href=\"".$e1."\" title=\"Noter 1\">".$ico."</a>";     $temp .= "<a href=\"".$e2."\" title=\"Noter 2\">".$ico."</a>";     $temp .= "<a href=\"".$e3."\" title=\"Noter 3\">".$ico."</a>";      $temp .= "<a href=\"".$e4."\" title=\"Noter 4\">".$ico."</a>";      $temp .= "<a href=\"".$e5."\" title=\"Noter 5\">".$ico."</a>";     $temp .= "</label>";   }  if($mode != "retour"){$temp .= "</label>";}  return $temp;}function nombre_notation($x,$y){  $q = "select * from notation where ".$y."='".$x."' and etat !='s'";  if($z = mysql_query($q)){    $nb = mysql_num_rows($z);  }else{    $nb = 0;  }  return $nb;}function affiche_note($x,$y,$cont){  $query = "select * from notation where ".$y."='".$x."' and etat != 's'";  if($z = mysql_query($query)){$nb = mysql_num_rows($z);}else{$nb = 0;}  if($nb == 0){    $c  = "gris";    $t = "(Aucune note)";  }else{    if($nb == 1){         $query = "select * from notation where ".$y."='".$x."' and etat != 's'";      $res = mysql_query($query);      $ligne = mysql_fetch_array($res);      if($ligne["data"]==""){$c  = "noir";}      if($ligne["data"]==0){$c  = "rouge";}      if($ligne["data"]==1){$c  = "orange";}      if($ligne["data"]==2){$c  = "jaune";}      if($ligne["data"]==3){$c  = "vert";}      if($ligne["data"]==4){$c  = "bleu";}      $t = $ligne["data"]."/4 pour 1 notation.";    }else{      $somme = 0;         $query = "select * from notation where ".$y."='".$x."' and etat != 's'";      $res = mysql_query($query);      while($ligne = mysql_fetch_array($res)){        $somme += $ligne["data"];            //$somme = $somme + $ligne["data"];      }         if($nb != 0 && $somme != 0){            $z = round($somme / $nb);}else{$z = $somme;         }      if($z <= 0 or $z >4){$c  = "noir";}      if($z == 0){$c  = "rouge";}      if($z == 1){$c  = "orange";}      if($z == 2){$c  = "jaune";}      if($z == 3){$c  = "vert";}      if($z == 4){$c  = "bleu";}      $t = $z."/4 pour ".$nb." notations.";     }   }   $tx = "";   if($y == "article"){      $tx ="de l'article";      $l = "A";   }   if($y == "vote"){      $tx ="du vote";      $l ="V";   }   if($y == "document"){      $tx ="du document";      $l ="D";   }   $temp = "<label id=\"notation".$l.$x."\" title=\"Note ".$tx." : ".$t."\" style=\"margin:5px;\">";   $temp .= "<img src=\"images/boutons/64/".$c.".png\">";   //if($cont == "t"){$temp .= "<br />".str_pad($nb, 4, "0", STR_PAD_LEFT);}   if(!user_notation($x,$y)){$temp .= noter($x,$y);}   $temp .= "</label>";  return $temp;}function affiche_note_texte($x,$y,$cont){  $query = "select * from notation where ".$y."='".$x."' and etat != 's'";  if($z = mysql_query($query)){$nb = mysql_num_rows($z);}else{$nb = 0;}  $somme = 0;   $nb_pour = 0;   $nb_sansopinion = 0;   $nb_contre = 0;  if($nb == 0){    $c  = "gris";    $t = "(Aucune note)";  }else{    if($nb == 1){         $query = "select * from notation where ".$y."='".$x."' and etat != 's'";      $res = mysql_query($query);      $ligne = mysql_fetch_array($res);      if($ligne["data"]==""){$c  = "noir";}      if($ligne["data"]==0){$c  = "rouge";}      if($ligne["data"]==1){$c  = "orange";}      if($ligne["data"]==2){$c  = "jaune";}      if($ligne["data"]==3){$c  = "vert";}      if($ligne["data"]==4){$c  = "bleu";}      $somme += $ligne["data"];         if($ligne["data"]== 4){$nb_pour += 1;}         if($ligne["data"]== 0){$nb_contre += 1;}         if($ligne["data"]== 2){$nb_sansopinion += 1;}      $t = $ligne["data"]."/4 pour 1 notation.";    }else{         $query = "select * from notation where ".$y."='".$x."' and etat != 's'";      $res = mysql_query($query);      while($ligne = mysql_fetch_array($res)){        $somme += $ligne["data"];            if($ligne["data"]== 4){$nb_pour += 1;}            if($ligne["data"]== 0){$nb_contre += 1;}            if($ligne["data"]== 2){$nb_sansopinion += 1;}            //$somme = $somme + $ligne["data"];      }         if($nb != 0 && $somme != 0){            $z = round($somme / $nb);}else{$z = $somme;         }      if($z <= 0 or $z >4){$c  = "noir";}      if($z == 0){$c  = "rouge";}      if($z == 1){$c  = "orange";}      if($z == 2){$c  = "jaune";}      if($z == 3){$c  = "vert";}      if($z == 4){$c  = "bleu";}      $t = $z."/4 pour ".$nb." notations.";     }   }   $tx = "";   if($y == "article"){      $tx ="de l'article";      $l = "A";   }   if($y == "vote"){      $tx ="du vote";      $l ="V";   }   if($y == "document"){      $tx ="du document";      $l ="D";   }   if(@$_SESSION["js"]=="1"){   $pour = "javascript:Ajax_Load('notation".$l.$x."','func.".$y.".notation.php?action=noter&note=4&".$y."=".$x."')";   $sansopinion = "javascript:Ajax_Load('notation".$l.$x."','func.".$y.".notation.php?action=noter&note=2&".$y."=".$x."')";   $contre = "javascript:Ajax_Load('notation".$l.$x."','func.".$y.".notation.php?action=noter&note=0&".$y."=".$x."')";  }else{   $pour = $_SESSION["index"]."?action=noter&note=4&".$y."=".$x;   $sansopinion = $_SESSION["index"]."?action=noter&note=2&".$y."=".$x;   $contre = $_SESSION["index"]."?action=noter&note=0&".$y."=".$x;  }   $temp = "";   if($cont != "retour"){      $temp .= "<label id=\"notation".$l.$x."\" style=\"border:1px solid #ddd;padding:5px;margin:0px;width:220px;\">";   }   $temp .= "<label style=\"margin-right:5px;padding:5px;width:50px;\" id=\"ibleu\">";   $temp .= "<h5 id=\"ibleu\" class=\"centre\">";   //$temp .= str_pad($nb, 4, "0", STR_PAD_LEFT);   $temp .= $nb;   $temp .= "<br />";   $temp .= "Vote".pluriel($nb);   $temp .= "</h5>";   $temp .= "</label>";   $temp .= "<label style=\"margin-right:5px;width:80px;\">";   if(!user_notation($x,$y)){      $temp .= "<div id=\"droite\"><a href=\"".$pour."\" title=\"Voter\">Pour</a></div>";      $temp .= "<div id=\"droite\"><a href=\"".$contre."\" title=\"Voter\">Contre</a></div>";      $temp .= "<div id=\"droite\"><a href=\"".$sansopinion."\" title=\"Voter\">Sans opinion</a></div>";   }else{      $temp .= "<div id=\"droite\">Pour</div>";      $temp .= "<div id=\"droite\">Contre</div>";      $temp .= "<div id=\"droite\">Sans opinion</div>";   }   $temp .= "</label>";   $temp .= "<label style=\"margin-right:5px;font-weight:bold;width:50px;\">";   $temp .= "<div id=\"centre\">".$nb_pour."</div>";   $temp .= "<div id=\"centre\">".$nb_contre."</div>";   $temp .= "<div id=\"centre\">".$nb_sansopinion."</div>";   $temp .= "</label>";   //$temp .= "<img src=\"images/boutons/64/".$c.".png\">";   //if($cont == "t"){$temp .= "<br />".str_pad($nb, 4, "0", STR_PAD_LEFT);}   if(!user_notation($x,$y)){      //$temp .= noter($x,$y);   }   if($cont != "retour"){$temp .= "</label>";}  return $temp;}function noter_texte($x,$y){   if($y == "article"){$l = "A";}   if($y == "vote"){$l = "V";}   if($y == "document"){$l = "D";}  if(@$_SESSION["js"]=="1"){   $z1 = "javascript:Ajax_Load('notation".$l.$x."','func.".$y.".notation.php?action=noter&note=4&".$y."=".$x."')";   $z2 = "javascript:Ajax_Load('notation".$l.$x."','func.".$y.".notation.php?action=noter&note=3&".$y."=".$x."')";   $z3 = "javascript:Ajax_Load('notation".$l.$x."','func.".$y.".notation.php?action=noter&note=2&".$y."=".$x."')";   $z4 = "javascript:Ajax_Load('notation".$l.$x."','func.".$y.".notation.php?action=noter&note=1&".$y."=".$x."')";   $z5 = "javascript:Ajax_Load('notation".$l.$x."','func.".$y.".notation.php?action=noter&note=0&".$y."=".$x."')";  }else{   $z1 = $_SESSION["index"]."?action=noter&note=4&".$y."=".$x;   $z2 = $_SESSION["index"]."?action=noter&note=3&".$y."=".$x;   $z3 = $_SESSION["index"]."?action=noter&note=2&".$y."=".$x;   $z4 = $_SESSION["index"]."?action=noter&note=1&".$y."=".$x;   $z5 = $_SESSION["index"]."?action=noter&note=0&".$y."=".$x;  }   $ty = "";  //$ty .= "Noter cet article.<br />";  $ty .= "<a href=\"".$z1."\" title=\"Noter 4 sur 4\"><img src=\"images/boutons/64/bleu.png\"></a>";  $ty .= "<a href=\"".$z2."\" title=\"Noter 3 sur 4\"><img src=\"images/boutons/64/vert.png\"></a>";  $ty .= "<a href=\"".$z3."\" title=\"Noter 2 sur 4\"><img src=\"images/boutons/64/jaune.png\"></a>";  $ty .= "<a href=\"".$z4."\" title=\"Noter 1 sur 4\"><img src=\"images/boutons/64/orange.png\"></a>";  $ty .= "<a href=\"".$z5."\" title=\"Noter 0 sur 4\"><img src=\"images/boutons/64/rouge.png\"></a>";  return $ty;}function noter($x,$y){   if($y == "article"){$l = "A";}   if($y == "vote"){$l = "V";}   if($y == "document"){$l = "D";}  if(@$_SESSION["js"]=="1"){   $z1 = "javascript:Ajax_Load('notation".$l.$x."','func.".$y.".notation.php?action=noter&note=4&".$y."=".$x."')";   $z2 = "javascript:Ajax_Load('notation".$l.$x."','func.".$y.".notation.php?action=noter&note=3&".$y."=".$x."')";   $z3 = "javascript:Ajax_Load('notation".$l.$x."','func.".$y.".notation.php?action=noter&note=2&".$y."=".$x."')";   $z4 = "javascript:Ajax_Load('notation".$l.$x."','func.".$y.".notation.php?action=noter&note=1&".$y."=".$x."')";   $z5 = "javascript:Ajax_Load('notation".$l.$x."','func.".$y.".notation.php?action=noter&note=0&".$y."=".$x."')";  }else{   $z1 = $_SESSION["index"]."?action=noter&note=4&".$y."=".$x;   $z2 = $_SESSION["index"]."?action=noter&note=3&".$y."=".$x;   $z3 = $_SESSION["index"]."?action=noter&note=2&".$y."=".$x;   $z4 = $_SESSION["index"]."?action=noter&note=1&".$y."=".$x;   $z5 = $_SESSION["index"]."?action=noter&note=0&".$y."=".$x;  }   $ty = "";  //$ty .= "Noter cet article.<br />";  $ty .= "<a href=\"".$z1."\" title=\"Noter 4 sur 4\"><img src=\"images/boutons/64/bleu.png\"></a>";  $ty .= "<a href=\"".$z2."\" title=\"Noter 3 sur 4\"><img src=\"images/boutons/64/vert.png\"></a>";  $ty .= "<a href=\"".$z3."\" title=\"Noter 2 sur 4\"><img src=\"images/boutons/64/jaune.png\"></a>";  $ty .= "<a href=\"".$z4."\" title=\"Noter 1 sur 4\"><img src=\"images/boutons/64/orange.png\"></a>";  $ty .= "<a href=\"".$z5."\" title=\"Noter 0 sur 4\"><img src=\"images/boutons/64/rouge.png\"></a>";  return $ty;}?>